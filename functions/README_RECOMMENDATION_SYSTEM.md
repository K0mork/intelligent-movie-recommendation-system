# AI推薦システム実装概要

## 実装内容

### 1. 推薦エンジンサービス (`recommendationEngine.ts`)
- **ハイブリッド推薦アルゴリズム**: コンテンツベースフィルタリング + 協調フィルタリング
- **個人化推薦**: ユーザーのレビュー履歴と感情分析結果を基にした推薦
- **Gemini API統合**: AI生成による推薦理由の自動作成
- **多様性ブースト**: ジャンルや監督の多様性を考慮した推薦結果

### 2. 推薦アルゴリズムの詳細

#### コンテンツベースフィルタリング
- ユーザーの好みジャンル、俳優、監督、キーワードとのマッチング
- 映画評価による品質フィルタリング
- 重み付きスコア計算（ジャンル30%、監督20%、俳優25%、キーワード15%、評価10%）

#### 協調フィルタリング
- 類似ユーザーの検索（コサイン類似度使用）
- 類似ユーザーの高評価映画を推薦候補として抽出
- ユーザー類似度による重み付きスコア計算

#### ハイブリッド推薦
- コンテンツベース（重み70%）+ 協調フィルタリング（重み30%）
- 多様性ブーストによるジャンル・監督の分散
- 信頼度による候補フィルタリング

### 3. AI推薦理由生成
- Gemini APIを使用した個別推薦理由の自動生成
- ユーザーの好みとの具体的関連性の説明
- 3つの短文による分かりやすい理由提示

### 4. Cloud Functions実装

#### 主要機能
- `generatePersonalizedRecommendations`: 個人化推薦生成
- `getSavedRecommendations`: 保存済み推薦取得
- `recordRecommendationFeedback`: フィードバック記録
- `getUserProfile`: ユーザープロファイル取得
- `getRecommendationStats`: 推薦システム統計（管理者用）

#### 映画データ管理
- `initializeSampleMovies`: サンプルデータ初期化
- `searchMovies`: 映画検索
- `getPopularMovies`: 人気映画取得
- `getMoviesByGenre`: ジャンル別映画取得
- `getMovieDetails`: 映画詳細取得
- `getMovieStats`: 映画統計情報

### 5. データベース構造

#### Firestoreコレクション
- `reviewAnalysis`: レビュー分析結果
- `userPreferences`: ユーザー好み履歴
- `userRecommendations`: 推薦結果保存
- `recommendationFeedback`: フィードバック履歴
- `movies`: 映画データベース

### 6. 主要機能フロー

1. **ユーザーレビュー投稿** → 感情分析実行 → 好み履歴更新
2. **推薦生成要求** → ユーザープロファイル取得 → アルゴリズム実行 → AI理由生成
3. **推薦表示** → フィードバック収集 → 学習データ蓄積

### 7. 技術スタック
- **AI/ML**: Google Gemini API
- **バックエンド**: Firebase Cloud Functions
- **データベース**: Cloud Firestore
- **開発言語**: TypeScript
- **認証**: Firebase Authentication

### 8. 品質保証
- 包括的エラーハンドリング
- ログ記録による監視
- フォールバック機能
- データ検証と型安全性

このシステムにより、ユーザーの映画レビューを深層学習で分析し、個人の好みに最適化された高品質な映画推薦を提供できます。